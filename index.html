<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Totec</title>
</head>
<body>
    <div id="logged_out" style="display: none;">
        <div class="text-center">
            <h1>Totec</h1>
        </div>
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                Usu√°rio
            </button>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
            <li><a class="dropdown-item" href="#" onclick=login()>Login</a></li>
            <li><a class="dropdown-item" href="#" onclick="signUp()">SignUp</a></li>
            </ul>
        </div>
    </div>

    <div id="logged_in" style="display: none;">
        <div class="text-center">
            <h1>Totec</h1>
        </div>
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                username
            </button>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
            <li><a class="dropdown-item" href="#" onclick="logout()">Logout</a></li>
            <li><a class="dropdown-item" href="#">Favorites</a></li>
            <li><a class="dropdown-item" href="#">Lists</a></li>
            </ul>
        </div>
    </div>
    <script>
        const request = (url, params = {}, method = 'GET', headers = {}) => {
            let options = {method};
            options.headers = headers;
            if ('GET' === method) {
                url += '?' + (new URLSearchParams(params)).toString();
            } else {
                options.body = JSON.stringify(params);
            }
            // prompt('url: ' + url + ' options: ' + JSON.stringify(options))
            return fetch(url, options);
        };
        const get = (url, params, headers) => request(url, params, 'GET', headers);
        const post = (url, params, headers) => request(url, params, 'POST', headers);
        // checks if user is logged in

        get('http://localhost:8080/isLogged').then(response => response.json()).then(data => {
            const username = data.username || 'Guest';
            const loggedIn = !!data.username;
            
            
            prompt("username expected: " + data.username)
            // prompt("is_logged: " + data)
            // prompt("is_logged: " + loggedIn)

            if(loggedIn){
                // alert("logged in")
                
                document.getElementById("logged_in").style.display = "block"
            }
            else{
                // alert("logged out")
                document.getElementById("logged_out").style.display = "block"
            }
            
        }).catch(error => {
            console.error('Error:', error);
        });
        
        
        // prompt("is_logged: " + document.getElementByName('res'));

        function login() {
        window.location.href = 'login.html'
        }

        function signUp() {
        window.location.href = 'signup.html'
        }

        function logout(){
            get('http://localhost:8080/logout').then(response => response.text()).then(data => {
                if(data == "Logout successful"){
                    window.location.href = 'index.html'
                }
            }).catch(error => {
                console.error('Error:', error);
            });
        }
    </script>

</body>

</html>